## Advance Express Concept

In this lecture we covered the light green highlighted portion from below diagram.
[![](https://mermaid.ink/img/pako:eNp1Uc9rgzAU_ldCdonQkl4bRmFTtzLq6tTCDl5S81wFNV3ysiGl__uiQncYuz2-X3zvvQuttAIqaN3q7-okDZIiKnvywLZFkZIczBeYYASWyw15ZCyDTwcWSQJ40iq4USFjh2zHSaYdAk-1wV8uYuzNgRl4Ko3s7P3R8A3fglRgLD9qNQSBEMLqDqpWWuttsy9mLEeJzpLQl_wjmjRPYyV71r0Fvi2SHZ_TX_L9Ky_i9-Kf6GfGwn2Wjx0nIoKa3FSkbtpW3K1Xcbxe0QXtwHSyUf5KlzGgpHiCDkoq_Kiglq7Fkpb91UulQ50PfUUFGgcL6s5KIkSN_PCbU1HL1noUVIPaJPPlpwdcfwCcJX0Z?type=png)](https://mermaid.live/edit#pako:eNp1Uc9rgzAU_ldCdonQkl4bRmFTtzLq6tTCDl5S81wFNV3ysiGl__uiQncYuz2-X3zvvQuttAIqaN3q7-okDZIiKnvywLZFkZIczBeYYASWyw15ZCyDTwcWSQJ40iq4USFjh2zHSaYdAk-1wV8uYuzNgRl4Ko3s7P3R8A3fglRgLD9qNQSBEMLqDqpWWuttsy9mLEeJzpLQl_wjmjRPYyV71r0Fvi2SHZ_TX_L9Ky_i9-Kf6GfGwn2Wjx0nIoKa3FSkbtpW3K1Xcbxe0QXtwHSyUf5KlzGgpHiCDkoq_Kiglq7Fkpb91UulQ50PfUUFGgcL6s5KIkSN_PCbU1HL1noUVIPaJPPlpwdcfwCcJX0Z)

Till last section we seen that how to pass data through params in this section we will see how to send data through headers & body, middleware , status code  and response type.

## Data through headers

- step-1 Add the below line inside your route to use the headers value. 

```
/* var lastIndex=req.query.counter */
    console.log(req.headers) // logging header
    var lastIndex=req.headers.counter // getting counter value which passed through headers
```

- step-2 Now run the code using ```node index``` and pass value into headers using Postman.

<i> if there is any error please google it.</i>

- Log of above code
```sh
{
  counter: '10',
  'user-agent': 'PostmanRuntime/7.36.1',
  accept: '*/*',
  'postman-token': 'b24f77d1-78b8-4e74-a4c9-9e682462d449',
  host: 'localhost:3000',
  'accept-encoding': 'gzip, deflate, br',
  connection: 'keep-alive'
}
```

- Response
```
Calculated Sum is : 55
```




## Data through body

- step- 1 add the below code into your route to use the body value

```
  console.log(req.body);
  var lastIndex = req.body.counter;
  console.log(lastIndex);
```

and send below body through Postman.

```
{
    "counter":10
}

```


and you will see below error after hitting the send button.

```
undefined
TypeError: Cannot read properties of undefined (reading 'counter')
```

from here middleware came into the picture.

## Middleware

[![](https://mermaid.ink/img/pako:eNoljbsKg0AURH9Fro2CiVGsNFiElClCUmZTXN3rA9xd2UckiP-eDU4zA2eGWaFVnKCEblJLO6C2we3BZODVZlF00WoxpNNzo9P6rowVKOP4cKgxjyKc52NPNixOVVhkVRzvO-OaXuM8BCOnLHj5-Yf0e2eY706SMwkJCNICR-7_1z9gYAcSxKD0kVOHbrIMmNx8FZ1Vz69sobTaUQJu5mjpOqI_E1B2OBnafh0yQiE?type=png)](https://mermaid.live/edit#pako:eNoljbsKg0AURH9Fro2CiVGsNFiElClCUmZTXN3rA9xd2UckiP-eDU4zA2eGWaFVnKCEblJLO6C2we3BZODVZlF00WoxpNNzo9P6rowVKOP4cKgxjyKc52NPNixOVVhkVRzvO-OaXuM8BCOnLHj5-Yf0e2eY706SMwkJCNICR-7_1z9gYAcSxKD0kVOHbrIMmNx8FZ1Vz69sobTaUQJu5mjpOqI_E1B2OBnafh0yQiE) [![](https://mermaid.ink/img/pako:eNo1jsEKgkAURX9FnpsRKrNaWbiIli2ilk2Lp_NMwZmR50wS0r83Id3VhXsPnAkqqwhyqDs7Vg2yi85XaaKQKhPiyHYciNNDyWlxsYPTaJJkuSxwI4RulepoRKYkmZHBl0_GvolaRVl0D-SL-DFvuPlhWyGw71dPcvFuvY932f7PklHSwAI0scZWBaXpN0hwDWmSkIeqqEbfOQnSfMIVvbO3t6kgd-xpAb5X6OjUYpDQkNfYDfT5AmXoSA0?type=png)](https://mermaid.live/edit#pako:eNo1jsEKgkAURX9FnpsRKrNaWbiIli2ilk2Lp_NMwZmR50wS0r83Id3VhXsPnAkqqwhyqDs7Vg2yi85XaaKQKhPiyHYciNNDyWlxsYPTaJJkuSxwI4RulepoRKYkmZHBl0_GvolaRVl0D-SL-DFvuPlhWyGw71dPcvFuvY932f7PklHSwAI0scZWBaXpN0hwDWmSkIeqqEbfOQnSfMIVvbO3t6kgd-xpAb5X6OjUYpDQkNfYDfT5AmXoSA0)


Express is a routing and middleware web framework that has minimal functionality of its own. An Express application is essentally a series of middleware function calls.

- Middleware functions are function that have access to the request object(req), the response objeect(res) and the next middleware function in the applications request-response cycle. The next middleware function is commonly denoted by a variable named next.

## Middlleware function can perform the following task.

- Execute any code.
- Make changes to the request and the response objects.
- End the request /response cycle.
- Call the next middleware function in the stack

## Example

- code

```sh
const express = require("express");
const app = express();
const port = 3000;

function middleware1(req,res,next){
  console.log("from inside middleware" + req.headers.counter)
  next();
}
app.use(middleware1);


function calculateSum(counter) {
  var sum = 0;
  for (var i = 0; i <= counter; i++) {
    sum = sum + i;
  }
  return sum;
}


function handleFirstRequest(req, res) {
  /* console.log(req.query);
     var lastIndex = req.query.counter;*/
     console.log(req.headers);
     var lastIndex = req.headers.counter;
  // console.log(req.body);
  // var lastIndex = req.body.counter;
  console.log(lastIndex);
  var calculatedSum = calculateSum(lastIndex);
  var answer = "Calculated Sum is : " + calculatedSum;
  console.log(answer);
  res.send(answer);
}

app.get("/handlesum", handleFirstRequest);

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`);
});


```

- Terminal Output

```
from inside middleware10
{
  counter: '10',
  'content-type': 'application/json',
  'user-agent': 'PostmanRuntime/7.36.1',
  accept: '*/*',
  'postman-token': 'f10c8d3f-b60e-4929-887f-269529503dc3',
  host: 'localhost:3000',
  'accept-encoding': 'gzip, deflate, br',
  connection: 'keep-alive',
  'content-length': '22'
}
10
Calculated Sum is : 55
```

## Again Sending data through body using middleware

- Step-1 Add dependency of middleware in express.

```
npm i body-parser
```

- step-2 write below code in index.js file using middleware

```javascript
const express = require("express");
const app = express();
const bodyParser=require("body-parser") //importing middleware
const port = 3000;


app.use(bodyParser.json()) // middleware



function calculateSum(counter) {
  var sum = 0;
  for (var i = 0; i <= counter; i++) {
    sum = sum + i;
  }
  return sum;
}


function handleFirstRequest(req, res) {
  /* console.log(req.query);
     var lastIndex = req.query.counter;*/
    //  console.log(req.headers);
    //  var lastIndex = req.headers.counter;
  console.log(req.body);
  var lastIndex = req.body.counter;
  console.log(lastIndex);
  var calculatedSum = calculateSum(lastIndex);
  var answer = "Calculated Sum is : " + calculatedSum;
  console.log(answer);
  res.send(answer);
}

app.get("/handlesum", handleFirstRequest);

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`);
});

```

- step-3 ```node index.js```

- Output

```Calculated Sum is : 55```

## Status code

### HTTP response status codes.

HTTP response status code indicate whether a specific <u><b>HTTP</b></u> request has been successfully completed. Response are grouped in five classes.

1. Information response (100-199)
2. Successful response (200-299)
3. Redirecting message (300-399)
4. Client Error Response (400-499)
5. Server Error Response (500-599)

```sh

function handleFirstRequest(req,res){
  var counter =req.headers.counter;
  if(counnter<10000){
    var calculateSum=calculatedSum(counter);
    var answer="the sum is"+ calculateSum;
    res.status(200).send(answer) // .status(200) is used
  }
  else{
    res.status(411).send("Cannot solve large amount. Please Use Others server") // .status(411) is used
  }
}

```

## Response Body Type

Till now we were sending Text.

- JSON body

```
var answerObject={
  Sum:calculatedSum
}
res.status(200).send(answerObject);
```
 OR

 ```
 var answerObject={
  Sum:calculatedSum
}
res.status(200).json(answerObject);
```

- HTML body

```
res.send("<head><title>Hello from Page</title></head><body><i>hi there</i></body")
```

- Sending file

```
res.ssend(__dirname_ +'./index.html')
```

## Server can talk to server

[![](https://mermaid.ink/img/pako:eNotTk0LgzAU-yvlnSoou5chbOy4wZjXXp72OR22ldd2MsT_vu4jpyQkJCt03hAo6Ce_dANyFOebdiLjIGXLfgnE5b7lXS1mH6JF91cu9x5BXNl3FEJR_EuiqmpxlLIhfhIXBZRgiS2OJo-sn5CGOJAlDSpTQz2mKWrQbstRTNE3L9eBipyohDQbjHQa8c5oQfU4heySGaPny-_49__2Bg25QQg?type=png)](https://mermaid.live/edit#pako:eNotTk0LgzAU-yvlnSoou5chbOy4wZjXXp72OR22ldd2MsT_vu4jpyQkJCt03hAo6Ce_dANyFOebdiLjIGXLfgnE5b7lXS1mH6JF91cu9x5BXNl3FEJR_EuiqmpxlLIhfhIXBZRgiS2OJo-sn5CGOJAlDSpTQz2mKWrQbstRTNE3L9eBipyohDQbjHQa8c5oQfU4heySGaPny-_49__2Bg25QQg)


## Example

step-1 Create index.js and run below code using ```node index.js```
```
const express = require("express");
const app = express();
const port = 3000;


function calculateSum(counter) {
  var sum = 0;
  for (var i = 0; i <= counter; i++) {
    sum = sum + i;
  }
  return sum;
}


function handleFirstRequest(req, res) {
  console.log(req.query);
  var lastIndex = req.query.counter;
  console.log(lastIndex);
  var calculatedSum = calculateSum(lastIndex);
  var answer = "Calculated Sum is : " + calculatedSum;
  console.log(answer);
  res.send(answer);
}

app.get("/handlesum", handleFirstRequest);

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`);
});
```
Step-2 Create new file ```responseServer.js``` and run below code using ```node responseServer.js```

```javascript
function logResponse(jsonBody) {
    console.log(jsonBody);
}

function callbackFn(result) {
    result.json().then(logResponse)
}

var sendObj = {
    method: "GET"
};

fetch("http://localhost:3000/handlesum?counter=10", sendObj).then(callbackFn)

```
